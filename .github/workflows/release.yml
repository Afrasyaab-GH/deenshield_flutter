name: Create Release

on:
  push:
    tags:
      - 'v*.*.*'  # Triggers on version tags like v0.1.0, v1.0.0, etc.

permissions:
  contents: write  # Required to create releases

jobs:
  create-release:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Fetch all history for all tags
      
      - name: Get version from tag
        id: get_version
        run: |
          VERSION=${GITHUB_REF#refs/tags/}
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          echo "Version: $VERSION"
      
      - name: Check if release notes exist
        id: check_notes
        run: |
          if [ -f "releases/RELEASE_NOTES.md" ]; then
            echo "notes_exist=true" >> $GITHUB_OUTPUT
            echo "Release notes found"
          else
            echo "notes_exist=false" >> $GITHUB_OUTPUT
            echo "Release notes not found"
          fi
      
      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          name: DeenShield ${{ steps.get_version.outputs.version }} - Experimental Release ðŸ•Œ
          body_path: ${{ steps.check_notes.outputs.notes_exist == 'true' && 'releases/RELEASE_NOTES.md' || '' }}
          body: ${{ steps.check_notes.outputs.notes_exist == 'false' && 'Release ${{ steps.get_version.outputs.version }}' || '' }}
          prerelease: true  # Mark as pre-release (experimental)
          draft: false
          files: |
            releases/DeenShield-Setup-*.exe
            releases/DeenShield-Portable-*.zip
            releases/DeenShield-Extension-*-Chrome.zip
            releases/DeenShield-Extension-*-Firefox.zip
            releases/DeenShield-Extension-*-All-Browsers.zip
            releases/SHA256SUMS.txt
            releases/RELEASE_NOTES.md
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Release created
        run: |
          echo "âœ… Release ${{ steps.get_version.outputs.version }} created successfully!"
          echo "ðŸ“¦ View at: https://github.com/${{ github.repository }}/releases/tag/${{ steps.get_version.outputs.version }}"
